"use strict";var e=require("./helpers-89ed3c40.js"),r=require("./register-394922e2.js"),t=require("fs"),s=require("fs-extra"),i=require("memory-fs"),n=require("path"),u=require("webpack");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("webpack-merge"),require("mini-css-extract-plugin"),require("optimize-css-assets-webpack-plugin"),require("terser-webpack-plugin"),require("slash"),require("react"),require("lz-string"),require("urlsafe-base64"),require("recursive-readdir");var o=a(t),c=a(s),f=a(i),d=a(n),l=a(u),p=process.cwd(),g=require("unionfs").ufs,q=new f.default;g.use(o.default).use(q);var y=function(e,t){for(var s=function(s){var i=t[s],n=r.getPageId(i,"_");e.use("/_react-ssr/".concat(n,".css"),(function(e,t){var s=d.default.join(p,r.ssrConfig.distDir,"".concat(n,".css")),i=r.existsSync(s)?o.default.readFileSync(s).toString():"";t.writeHead(200,{"Content-Type":"text/css"}),t.end(i,"utf-8")})),e.use("/_react-ssr/".concat(n,".js"),(function(e,t){var s=d.default.join(p,r.ssrConfig.distDir,"".concat(n,".js")),i=o.default.readFileSync(s).toString();t.status(200).type(".js").send(i)}))},i=0;i<t.length;i++)s(i)},x=function(){var t=r._asyncToGenerator(r.regenerator.mark((function t(s){var i,n,u,a,o,f;return r.regenerator.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getEntry(q);case 2:if(i=t.sent,n=e._slicedToArray(i,2),u=n[0],a=n[1],!r.ssrConfig.usePreCompiled||r.existsSync(d.default.join(p,r.ssrConfig.distDir))){t.next=10;break}throw new Error("Build dir not found and `usePreCompiled` is set to `true`.");case 10:if(!r.ssrConfig.usePreCompiled||!r.existsSync(d.default.join(p,r.ssrConfig.distDir))){t.next=14;break}y(s,a),t.next=21;break;case 14:if(r.ssrConfig.usePreCompiled){t.next=21;break}return c.default.removeSync(d.default.join(p,r.ssrConfig.distDir)),o=e.configureWebpack(u),(f=l.default(o)).inputFileSystem=g,t.next=21,new e.promise((function(e,r){f.run((function(t,i){t&&r(t.stack||t),i.hasErrors()&&r(i.toString()),y(s,a),e()}))}));case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();exports.default=x;
